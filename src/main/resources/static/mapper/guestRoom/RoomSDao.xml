<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.goodsoft.hotel.domain.dao.guestRoom.RoomSDao">

    <!--主页面房态信息 start-->

    <!--房态 主页面 获取楼层信息-->
    <select id="queryFloorMapper" resultType="com.goodsoft.hotel.domain.entity.guestRoom.Floors">
        select DISTINCT b.FLOORCODE,b.FLOORNAME,b.FLOORID FROM gs_room a,gs_floor b where  a.FLOORCODE=b.FLOORCODE AND b.FLOORNAME !='业主自用房' ORDER BY b.FLOORID
    </select>


    <!--房态 主页面 通过楼层号获取房间信息-->
    <select id="queryFloorRoomMapper" parameterType="java.util.Map"
            resultType="java.util.Map">
        SELECT * FROM
        (select id,roomNo,doorlockId,remark,flag,sFlag from gs_room
        where floorcode=#{floorcode} AND floorcode!='202'
        ) x
        LEFT JOIN
        (SELECT a.guestName,a.startDate,a.endDate,b.roomId FROM gs_quickbooking a,gs_quickbooking_roomno b WHERE a.id = b.bookid AND
        unix_timestamp(NOW()) &lt;  unix_timestamp(a.enddate) AND
        unix_timestamp(NOW())  &gt; unix_timestamp(a.startdate)) y
        ON x.id = y.roomid
    </select>


    <!--房态右边下拉框 获取楼层名-->
    <select id="findFloorAllMapper" resultType="com.goodsoft.hotel.domain.entity.guestRoom.Floors">
        select floorCode,floorName FROM gs_floor
    </select>

    <!--房态右边下拉框楼层名获取房间信息 显示到左边-->
    <select id="findFloorNameGetRoomMapper" parameterType="java.lang.String" resultType="java.util.Map">
        SELECT * FROM
        (select id,roomNo,doorlockId,remark,flag,sFlag from gs_room
        where floorcode=#{floorcode} AND floorcode!='202'
        ) x
        LEFT JOIN
        (SELECT a.guestName,a.startDate,a.endDate,b.roomId FROM gs_quickbooking a,gs_quickbooking_roomno b WHERE a.id = b.bookid AND
        unix_timestamp(NOW()) &lt;  unix_timestamp(a.enddate) AND
        unix_timestamp(NOW())  &gt; unix_timestamp(a.startdate)) y
        ON x.id = y.roomid
    </select>

    <!--房态:右边下拉框 获取房间类型 -->
    <select id="queryRoomTypeMapper" resultType="com.goodsoft.hotel.domain.entity.guestRoom.RoomType">
        SELECT * from gs_roomtype
    </select>

    <!--房态:右边下拉框 通过房间类型 获取房间信息-->
    <select id="queryRoomTypeGetRoomMapper" parameterType="java.lang.String" resultType="java.util.Map">
        SELECT * FROM
        (select id,roomNo,doorlockId,remark,flag,sFlag from gs_room
        where roomtype=#{roomType} AND floorcode!='202'
        ) x
        LEFT JOIN
        (SELECT a.guestName,a.startDate,a.endDate,b.roomId FROM gs_quickbooking a,gs_quickbooking_roomno b WHERE a.id = b.bookid AND
        unix_timestamp(NOW()) &lt;  unix_timestamp(a.enddate) AND
        unix_timestamp(NOW())  &gt; unix_timestamp(a.startdate)) y
        ON x.id = y.roomid
    </select>

    <!--主界面房态信息   end-->

    <!--***************************************************我是分割线***************************************************-->

    <!--快速预定房间信息start-->

    <!--快速预定的房态,左边的列表选择-->
    <select id="queryRoomALLMapper" resultType="java.util.Map">
        SELECT a.ID,a.typeId,a.ROOMTYPE,a.TYPENAME,a.HOUSEPRICES,COUNT(b.FLAG) roomSum FROM gs_roomtype a,gs_room b where a.ROOMTYPE=b.ROOMTYPE AND b.FLAG='空房' GROUP BY a.ROOMTYPE
    </select>

    <!--根据房间类型id获取房间号-->
    <select id="selectKongMapper" resultType="java.util.Map">
        SELECT a.id,a.roomid,a.ROOMNO,a.doorLockId,b.housePrices,b.typename,b.roomType FROM gs_room a,gs_roomtype b where
        a.ROOMTYPE=b.ROOMTYPE AND a.FLAG='空房'
        AND b.typeId IN
        <foreach collection="list" index="index" item="str" open="(" separator="," close=")">
            #{str}
        </foreach>
    </select>

    <!--快速预定房间信息 end-->

    <!--***************************************************我是分割线***************************************************-->

    <!--快速分房接口Start-->

    <!--右边第一个房间类型-->
    <select id="findRoomTypeFenFangMapper" resultType="com.goodsoft.hotel.domain.entity.guestRoom.RoomType">
        select * FROM gs_roomtype
    </select>

    <!--右边第二个建筑楼层-->
    <select id="findBuildingFenFangMapper" parameterType="java.lang.String" resultType="com.goodsoft.hotel.domain.entity.guestRoom.Building">
        select DISTINCT a.* FROM gs_building a,gs_room b WHERE a.buildingcode = b.buildingcode
            AND b.roomType = #{_parameter}
    </select>

    <!--右边第三个获取楼层-->
    <select id="findFloorsFenFangMapper" parameterType="java.lang.String" resultType="com.goodsoft.hotel.domain.entity.guestRoom.Floors">
        select DISTINCT a.* FROM gs_floor a,gs_room b WHERE a.floorcode = b.floorcode
            AND b.buildingcode = #{_parameter}
    </select>
    
    <!--左边房间查询房间-->
    <select id="findRoomFenFangMapper" parameterType="java.util.Map" resultType="java.util.Map" >
        select * from
        (
        SELECT c.buildingname,d.floorname,b.typename,a.id,a.roomno,a.remark,a.flag,a.sflag from gs_room a,gs_roomtype b,gs_building c ,gs_floor d
        WHERE a.roomtype=b.roomtype AND a.buildingcode = c.buildingcode AND a.floorcode = d.floorcode AND
        <if test="roomType != null and roomType !='' ">
            AND a.roomType = #{roomType}
        </if>
        <if test="buildingCode !=null and buildingCode !='' ">
            AND a.buildingCode=#{buildingCode}
        </if>
        <if test="floorCode !=null and floorCode !='' ">
            AND a.floorCode = #{floorCode}
        </if>
        <if test="flag !=null and flag !='' ">
            and a.flag= #{flag}
        </if>
        <if test="sflag != null and flag != '' ">
            and a.sflag= #{sflag}
        </if>
        ) x
        LEFT JOIN
        (
        select w.roomid,q.bookingno,q.guestname,q.markets,q.salesman,q.startdate,q.enddate,q.releasetime,q.days,q.remark,w.roomno
        from gs_quickbooking q ,gs_quickbooking_roomno w where q.id = w.bookid
        <if test="startDate !=null and startDate != ''">
            AND unix_timestamp(q.startdate) &gt;= unix_timestamp(#{endDate})
        </if>
        <if test="endDate !=null and endDate != '' ">
            and unix_timestamp(q.enddate) &lt;= unix_timestamp(#{endDate})
        </if>
        ) y
        ON x.roomno = y.roomid
    </select>
    <!--快速分房接口end-->


    <!--***************************************************我是分割线***************************************************-->


    <!--建筑添加信息-->
    <insert id="insertBuild" parameterType="com.goodsoft.hotel.domain.entity.guestRoom.Building">
        INSERT INTO gs_building(ID,BUILDINGCODE,BUILDINGNAME) VALUES(#{ID},#{buildingCode},#{buildingName})
    </insert>

    <!--楼层添加信息-->
    <insert id="insertFloor" parameterType="com.goodsoft.hotel.domain.entity.guestRoom.Floors">
        INSERT INTO gs_floor(ID,FLOORCODE,FLOORNAME) VALUES(#{id},#{floorCode},#{floorName})
    </insert>

    <!--添加房间类型名称-->
    <insert id="insertRoomType" parameterType="com.goodsoft.hotel.domain.entity.guestRoom.RoomType">
        insert into gs_roomtype(ID,ROOMTYPE,TYPENAME,HOUSEPRICES) VALUES(#{id},#{roomType},#{typeName},#{housePrices})
    </insert>


    <!--暂时没用到的接口,添加房间信息详情-->
    <insert id="insertRoom" parameterType="com.goodsoft.hotel.domain.entity.guestRoom.Room">
        INSERT INTO gs_room(ID,ROOMTYPE,ROOMNO,CNAME,BUILDINGCODE,FLOORCODE,HOUSEPRICES,NIGHTS,STDPAX,MAXPAX,STATUS,DOORLOCKID,REMARK,FLAG,RACKPATE,RATECODE) VALUES
        (#{id},#{roomType},#{roomNo},#{cName},#{buildingCode},#{floorCode},#{housePrices},#{nights},#{stdPax},#{maxPax},#{status},#{doorLockId},#{remark},#{flag},#{rackRate},#{rateCode})
    </insert>



    <!--添加房价信息-->

    <insert id="addRoomPricesMapper" parameterType="com.goodsoft.hotel.domain.entity.guestRoom.RoomPrices">
        insert INTO gs_roomprices VALUES (#{id},#{roomTypeId},#{setStartTime},#{roomPrices})
    </insert>


</mapper>